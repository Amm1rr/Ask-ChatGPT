Build1=Default,com.ask.chatgpt
File1=Acme-Regular.ttf
File10=Bg-Chat09.jpg
File11=Bg-Chat10.jpg
File12=brain.png
File13=Changelog.txt
File14=Chat.bal
File15=clvAnswerRow.bal
File16=clvQuestionRow.bal
File17=clvWaitingText.bal
File18=gray-tipped.png
File19=LeftDrawer.bal
File2=Bg-Chat01.jpg
File20=menu.png
File21=message.png
File22=montserrat-medium.ttf
File23=PROMPTS.md
File24=puton.png
File25=RightDrawer.bal
File26=roboto-regular.ttf
File27=settings.png
File28=Share.bal
File29=voice.png
File3=Bg-Chat02.jpg
File4=Bg-Chat03.jpg
File5=Bg-Chat04.jpg
File6=Bg-Chat05.jpg
File7=Bg-Chat06.jpg
File8=Bg-Chat07.jpg
File9=Bg-Chat08.jpg
FileGroup1=Default Group
FileGroup10=Default Group
FileGroup11=Default Group
FileGroup12=Default Group
FileGroup13=Default Group
FileGroup14=Default Group
FileGroup15=Default Group
FileGroup16=Default Group
FileGroup17=Default Group
FileGroup18=Default Group
FileGroup19=Default Group
FileGroup2=Default Group
FileGroup20=Default Group
FileGroup21=Default Group
FileGroup22=Default Group
FileGroup23=Default Group
FileGroup24=Default Group
FileGroup25=Default Group
FileGroup26=Default Group
FileGroup27=Default Group
FileGroup28=Default Group
FileGroup29=Default Group
FileGroup3=Default Group
FileGroup4=Default Group
FileGroup5=Default Group
FileGroup6=Default Group
FileGroup7=Default Group
FileGroup8=Default Group
FileGroup9=Default Group
Group=Default Group
Library1=amir_smoothcheckbox
Library10=keyvaluestore2
Library11=md2html4a.11
Library12=okhttputils2
Library13=phone
Library14=randomaccessfile
Library15=reflection
Library16=securemytext
Library17=viewsex
Library18=webviewextras2
Library19=xcustomlistview
Library2=as_textfieldadvanced
Library20=xui views
Library21=sql
Library3=b4xdraweradvanced
Library4=bctextengine
Library5=clipboard
Library6=core
Library7=designerutils
Library8=ime2
Library9=json
ManifestCode='This code will be applied to the manifest file during compilation.~\n~'You do not need to modify it in most cases.~\n~'See this link for for more information: https://www.b4x.com/forum/showthread.php?p=78136~\n~AddManifestText(~\n~<uses-sdk android:minSdkVersion="5" android:targetSdkVersion="31"/>~\n~<supports-screens android:largeScreens="true" ~\n~    android:normalScreens="true" ~\n~    android:smallScreens="true" ~\n~    android:anyDensity="true"/>)~\n~SetApplicationAttribute(android:icon, "@drawable/icon")~\n~SetApplicationAttribute(android:label, "$LABEL$")~\n~CreateResourceFromFile(Macro, Themes.LightTheme)~\n~'End of default text.~\n~~\n~AddActivityText(ACTION_PROCESS_TEXT,~\n~<intent-filter>~\n~   <action android:name="android.intent.action.SEND" />~\n~   <category android:name="android.intent.category.DEFAULT" />~\n~   <data android:mimeType="text/*" />~\n~</intent-filter>)~\n~'  <data android:mimeType="image/*" />~\n~~\n~SetApplicationAttribute(android:launchMode,  "singleTask")~\n~'SetActivityAttribute(main, android:launchMode, "standard")~\n~'SetActivityAttribute(ACTION_PROCESS_TEXT, android:launchMode, "singleTop")~\n~~\n~'For Creating custom Text Selection actions with ACTION_PROCESS_TEXT~\n~SetActivityAttribute(ACTION_PROCESS_TEXT, android:label, "Ask ChatGPT")~\n~AddActivityText(ACTION_PROCESS_TEXT,~\n~<intent-filter>~\n~	<action android:name="android.intent.action.PROCESS_TEXT" />~\n~	<category android:name="android.intent.category.DEFAULT" />~\n~	<data android:mimeType="text/plain" />~\n~</intent-filter>)~\n~~\n~~\n~'########## Transparent 		# First Method: Without Transparent Statusbar~\n~' این روش نور وضعیت رو سیاه رنگ میکنه ولی از طریق کد~\n~' نوار وضعیت رو شفاف کردم~\n~~\n~'SetActivityAttribute(ACTION_PROCESS_TEXT, android:theme, "@android:style/Theme.Translucent")~\n~'SetActivityAttribute (Reciver, android:theme, "@android:style/Theme.Translucent")~\n~~\n~'########## Transparent 		# Seconde Method: With Transparent Statusbar~\n~' این متد نوار وظیفه رو همرنگ پس زمینه میکنه ولی در هنگار اجرای اولیه ی اکتیویتی~\n~' یه لِگ کوچیک داره که زیاد جالب نیست، با جستجوی بیشتر احتمالا میشه مشکلش رو حل کرد.~\n~~\n~SetActivityAttribute(ACTION_PROCESS_TEXT, android:theme, "@style/Theme_Main")~\n~~\n~CreateResource (values, theme_main.xml,~\n~<resources>~\n~	<style name="Theme_Main" parent="android:Theme">~\n~		<item name="android:windowIsTranslucent">true</item>~\n~		<item name="android:windowBackground">@android:color/transparent</item>~\n~		<item name="android:windowContentOverlay">@null</item>~\n~		<item name="android:windowNoTitle">true</item>~\n~		<item name="android:windowIsFloating">true</item>~\n~		<item name="android:backgroundDimEnabled">false</item>~\n~</style>~\n~</resources>~\n~)~\n~
Module1=ACTION_PROCESS_TEXT
Module2=Bart
Module3=ChatGPT
Module4=ChatN
Module5=CLVNested
Module6=General
Module7=ResizingTextComponent
Module8=Starter
Module9=UpDown
NumberOfFiles=29
NumberOfLibraries=21
NumberOfModules=9
Version=12.2
@EndOfDesignText@
#Region Project Attributes
	#ApplicationLabel: Ask ChatGPT
	#VersionCode: 13
	#VersionName: Develop
	'SupportedOrientations possible values: unspecified, landscape or portrait.
	#SupportedOrientations: portrait
	#CanInstallToExternalStorage: False
#End Region

#Region Activity Attributes
	#FullScreen: False
	#IncludeTitle: False
#End Region

#BridgeLogger: True

Sub Process_Globals
	Private OldIntent 				As Intent
	Private TextHolder				As String
	Private ColorLog				As Int 	= Colors.Magenta
	Public	Voicer 					As VoiceRecognition
	Public 	ActionBarHomeClicked 	As Boolean
	Public 	TextShared				As String
	Public  intpub					As Intent
	
	Type Setting(FirstLang 	As String, _
				 SecondLang As String, _
				 Creativity As Int, _
				 AutoSend 	As Boolean, _
				 Memory 	As Boolean, _
				 IsDevMode 	As Boolean)		'If its in Debug Mode, just for MySelf
End Sub

Sub Globals
	Private ChatN1 				As ChatN
	Private ime 				As IME2
End Sub

Private Sub MyLog(text As String, color As Int, AlwaysShow As Boolean)
	General.MyLog("Main." & text, color, AlwaysShow)
End Sub

Sub Activity_Create(FirstTime As Boolean)
	
	MyLog("Activity_Create: " & FirstTime & ", " & TextShared, ColorLog, True)
	
'	General.LoadSetting
	General.LoadSettingDB
	
	intpub = Activity.GetStartingIntent
	If Not (ChatN1.IsInitialized) Then ChatN1.Initialize(Activity, "")
'	If (TextShared = "[NEW]") Then
'		
'		LogColor("Main.Create [New]", Colors.Red)
'		
'		ChatN1.Initialize(Activity, "")
''		TextShared = ""
'
'	Else If (TextShared <> "") Then
'		
'		LogColor("Main.Create SHARED", Colors.Red)
'		
'		ChatN1.Initialize(Activity, TextShared)
'		intpub = Null
''		TextShared = ""
'	Else
'		
'		LogColor("Main.Create Else", Colors.Red)
'		
'		ChatN1.Initialize(Activity, "")
'		ChatN1.txtQuestion.RequestFocus
'	End If
	Activity.Title = "Ask ChatGPT"
	
	Voicer.Initialize("vr")
	
	ime.Initialize("ime")
	ime.AddHeightChangedEvent
	
End Sub

Sub Activity_Pause (UserClosed As Boolean)
	
	TextHolder = ChatN1.txtQuestion.Text
	MyLog("Activity_Pause: " & TextHolder, ColorLog, True)
	ChatN1.IME_HeightChanged(100%y, 0)
	General.SaveSetting
	
	If (UserClosed) Then General.sql.Close
	
End Sub

Sub Activity_Resume
	
	MyLog("Activity_Resume: " & TextShared, ColorLog, True)
	
	ChatN1.IME_HeightChanged(100%y, 0)
	
	If (TextShared = "[NEW]") Then
		LogColor("Main.Resume [New]", Colors.Red)
		
		ChatN1.ResetAI
		ChatN1.txtQuestion.Text = ""
		
'		Sleep(0)
'		Dim chat As ChatN
'			chat.Initialize(Activity, "")
'			ChatN1.ResetAI
		TextShared = ""
		
'	Else If IsRelevantIntent(Activity.GetStartingIntent) Then
	Else If IsRelevantIntent(intpub) Then
		
		LogColor("Main.Resume.SHARE", Colors.Red)
		
		Dim intent As JavaObject = Activity.GetStartingIntent
		
		Dim cType As String = intent.RunMethod("getType", Null)
		If Not (cType.Contains("text")) Then Return
		
		TextShared = Activity.GetStartingIntent.GetExtra("android.intent.extra.TEXT") 'Get the shared text
		
		Sleep(0)
		
		CallSubDelayed2(ACTION_PROCESS_TEXT, "Activity_Create", False)
'		ChatN1.ResetAI
'		ChatN1.txtQuestion.Text = TextShared
		
		TextShared = ""
		
		#Region Shared a Image
'		'### It's Image
'		Dim uri As String = intent.RunMethod("getParcelableExtra", Array("android.intent.extra.STREAM"))
'		Dim flag As Boolean
'		Try
'			Log("Loading bitmap from: " & uri)
'			Dim bmp As Bitmap = LoadBitmapResize("ContentDir", uri, 100%x, 100%y,flag)
'			Activity.SetBackgroundImage(bmp)
'		Catch
'			Log(LastException)
'		End Try
		#End Region
	
	Else If (TextShared <> "") Then
		LogColor("Main.Resume.OpenIn: " & TextShared, Colors.Red)
		ChatN1.ResetAI
		ChatN1.txtQuestion.Text = TextShared
	Else If (TextHolder <> "") Then
		LogColor("Main.Resume: " & TextHolder, Colors.Red)
		ChatN1.ResetAI
		ChatN1.txtQuestion.Text = TextHolder
	Else
		'Do Somthing
		LogColor("Main.Resume.Else: " & TextShared & " - " & TextHolder, Colors.Red)
		ChatN1.ResetAI
	End If
	
	
End Sub

'Recive Text
Private Sub IsRelevantIntent(in As Intent) As Boolean
	MyLog("IsRelevantIntent", ColorLog, False)
	If in.IsInitialized And in <> OldIntent And in.Action = in.ACTION_SEND Then
		OldIntent = in
		Return True
	End If
	Return False
End Sub

Private Sub ShareText(text As String)
	MyLog("ShareText: " & text, ColorLog, False)
	Dim in As Intent
		in.Initialize(in.ACTION_SEND, "")
		in.PutExtra("android.intent.extra.TEXT", text)
		in.SetType("text/plain")
		in.WrapAsIntentChooser("Share Via")
	StartActivity(in)
End Sub

Private Sub SendToInstagram(text As String)
'	MyLog("SendToInstagram: " & text, ColorLog, False)
'	Dim u As Uri 'ContentResolver library
'	u.Parse("file://" & File.Combine(a, "tmpfile.jpg"))
'	Dim inten As Intent
'	Dim tmpt As String = "your text"
'	inten.Initialize(inten.ACTION_SEND,"")
'	inten.SetType("image/*")
'	inten.PutExtra("android.intent.extra.STREAM",u)
'	inten.PutExtra("android.intent.extra.TEXT",tmpt)
'	inten.SetComponent("com.instagram.android/com.instagram.share.handleractivity.ShareHandlerActivity")
'	StartActivity(inten)
End Sub

Private Sub SendToTwitter(text As String)
'	MyLog("SendToTwitter: " & text, ColorLog, False)
'	Dim u As Uri 'ContentResolver library
'	u.Parse("file://" & File.Combine(a, "tmpfile.jpg"))
'	Dim inten As Intent
'	Dim tmpt As String = "your text"
'	inten.Initialize(inten.ACTION_SEND,"")
'	inten.SetType("image/*")
'	inten.PutExtra("android.intent.extra.STREAM",u)
'	inten.PutExtra("android.intent.extra.TEXT",tmpt)
'	inten.SetComponent("com.twitter.android/com.twitter.composer.ComposerActivity")
'	StartActivity(inten)


'	Dim IntentInstagram As String
'	Dim IntentTwitter As String
'	Dim pm As PackageManager
'    
'	For Each cn As String In pm.QueryIntentActivities(inten)
'		'Instagram
'		If cn.SubString2(0,19) = "com.twitter.android" Then
'			IntentTwitter = cn
'			Exit
'		End If
'
'		'OR
'
'		'Twitter
'		If cn.SubString2(0,21) = "com.instagram.android" Then
'			IntentInstagram = cn
'			Exit
'		End If
'	Next
End Sub

#if Java
public boolean _onCreateOptionsMenu(android.view.Menu menu) {
	 processBA.raiseEvent(null, "create_menu", menu);
	 return true;
	
}
#End If
#End Region

'Program code should go into B4XMainPage and other pages.
